// ==UserScript==
// @name         ReadIt
// @namespace    http://github.com/tralwdwd/
// @version      1.0.0
// @description  A userscript for Reddit Web with plugin support.
// @author       tralwdwd
// @match        https://*.reddit.com/*
// @icon         https://www.redditstatic.com/desktop2x/img/favicon/apple-icon-76x76.png
// @run-at       document-end
// @downloadURL  https://raw.githubusercontent.com/readit-mod/builds/refs/heads/main/readit.user.js
// @grant        GM.xmlHttpRequest
// @grant        unsafeWindow
// @grant        GM.getValue
// @grant        GM.setValue
// ==/UserScript==

// This code has been bundled, for source code go to https://github.com/readit-mod/readit


(function(){"use strict";class Ye{constructor(t){this.readit=t,this.selector="shreddit-post, shreddit-ad-post",this.postCallbacks=[],this._queuedPosts=new Set,this._rafScheduled=!1,this.registerOnPostsLoaded=s=>{this.postCallbacks.push(s),this._callbackInitialScan()},new MutationObserver(s=>{for(const a of s)for(const r of Array.from(a.addedNodes))r.nodeType===1&&r instanceof HTMLElement&&(r.matches(this.selector)&&this._queuedPosts.add(r),r.querySelectorAll(this.selector).forEach(n=>this._queuedPosts.add(n)));this._scheduleEmit()}).observe(document.body,{childList:!0,subtree:!0})}_callbackInitialScan(){const t=document.querySelectorAll(this.selector);t.length>0&&this._emitPosts(Array.from(t))}_scheduleEmit(){this._rafScheduled||(this._rafScheduled=!0,window.requestAnimationFrame(()=>{this._queuedPosts.size>0&&(this._emitPosts(Array.from(this._queuedPosts)),this._queuedPosts.clear()),this._rafScheduled=!1}))}_emitPosts(t){this.postCallbacks.forEach(i=>i(t))}}const Ke=(e=>e)({name:"ReadIt Adblock",description:"Builtin plugin to remove ads from the website.",id:"readit-adblock",version:"1.0.0",onLoad:async e=>{let t=await e.storage.get("ads-blocked",0);e.posts.registerLoadCallback(async i=>{i.forEach(s=>{s.matches("shreddit-ad-post")&&(t++,s.remove())}),await e.storage.set("ads-blocked",t)}),e.settings.registerSettingsTile({title:"Ads Blocked",description:`Total ads blocked: ${t}`}),e.logging.info("Loaded successfully...")}}),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));async function et(e){const t=await new Promise((a,r)=>{GM.xmlHttpRequest({method:"GET",url:e,onload:c=>a(c.responseText),onerror:c=>r(c)})}),i=new Blob([t],{type:"text/javascript"}),s=URL.createObjectURL(i);try{return await import(s)}finally{URL.revokeObjectURL(s)}}function tt(e){return{registerLoadCallback:t=>e.registerOnPostsLoaded(t)}}function nt(e){return{registerSettingsTile:t=>e.registerSettingsTile(t),registerSettingsPage:t=>e.registerSettingsPage(t),registerNavigationTile:t=>e.registerNavigationTile(t)}}function rt(e,t){return{info:i=>e.info(`[${t.name}] ${i}`),error:i=>e.error(`[${t.name}] ${i}`),warn:i=>e.warn(`[${t.name}] ${i}`)}}function st(e,t){return{async get(i,s){return await e.get(`plugin:${t}`,i,s)},async set(i,s){return await e.set(`plugin:${t}`,i,s)},async delete(i){return await e.delete(`plugin:${t}`,i)},async keys(){return await e.keys(`plugin:${t}`)}}}function pe(e,t){return{posts:tt(e.posts),settings:nt(e.settings),storage:st(e.storage,t.id),logging:rt(e.logging,t)}}class it{constructor(t){this.readit=t,this.unloadedPluginList=[],this.loadedPluginList=[],localStorage.getItem("plugins")==null&&localStorage.setItem("plugins","[]");const i=JSON.parse(localStorage.getItem("plugins"));this.unloadedPluginList=i}get pluginList(){return this.loadedPluginList}async loadPlugins(){console.log(this.unloadedPluginList),await this.loadBuiltins(),this.unloadedPluginList.forEach(async t=>{try{await this.loadPlugin(t.url)}catch(i){console.error("Plugin execution failed, URL:",t.url,i)}})}async loadBuiltins(){const t=Object.assign({"./builtin/ReadItAdBlock/index.ts":Qe});for(const i of Object.values(t)){const s=i.default,a=pe(this.readit,s);this.loadedPluginList.push(s),await s.onLoad(a)}}async loadPlugin(t){try{const s=(await et(t)).default;this.loadedPluginList.push(s);const a=pe(this.readit,s);await s.onLoad(a)}catch(i){console.error("Failed to load plugin:",i)}}async addPlugin(t){const i=await this.readit.storage.get("core","plugins",[]);i.push({url:t}),await this.readit.storage.set("core","plugins",i),alert("New Plugins require a reload!")}onLoadedPlugins(){this.readit.settings.registerSettingsPage({id:"add-plugin",title:"Add Plugin",items:[{title:"Add with RAW URL",description:"Add a new plugin by RAW URL",onClick:()=>{let t=prompt("Enter the valid RAW URL of the plugin:");t&&this.addPlugin(t)}},{title:"Add from GitHub Repo",description:"Add a new plugin by GitHub Repo URL",onClick:()=>{let t=prompt("Enter the GitHub Repo URL of the plugin");if(t){let s=function(a){const r=a.match(/^https:\/\/github\.com\/([^/]+)\/([^/]+)(?:\/.*)?$/);if(!r)throw new Error("Invalid GitHub repo URL");const[,c,n]=r;return`https://raw.githubusercontent.com/${c}/${n}/builds/plugin.js`}(t);this.addPlugin(s)}}}]}),this.readit.settings.registerNavigationTile({id:"add-plugin",title:"Add Plugin",description:"Add a new plugin to ReadIt",icon:"➕"})}}const q=()=>typeof _nano<"u"&&_nano.isSSR===!0,ot=Promise.prototype.then.bind(Promise.resolve()),at=e=>{let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t|=0}return Math.abs(t).toString(32)},se=(e,t,i=!0)=>{if(!Array.isArray(t)){se(e,[t],i);return}typeof t=="object"&&(t=Array.prototype.slice.call(t)),t.forEach(s=>{if(Array.isArray(s))se(e,s,i);else{const a=k(s);typeof a<"u"&&(Array.isArray(a)?se(e,a,i):q()&&!i?e.appendChild(a.nodeType==null?a.toString():a):e.appendChild(a.nodeType==null?document.createTextNode(a.toString()):a))}})},lt=e=>{const t=e.children[0],i=t.attributes;if(q())return t;const s=_e("svg");for(let a=i.length-1;a>=0;a--)s.setAttribute(i[a].name,i[a].value);return s.innerHTML=t.innerHTML,s},k=e=>{if(e===null||e===!1||typeof e>"u")return[];if(typeof e=="string"||typeof e=="number")return e.toString();if(e.tagName&&e.tagName.toLowerCase()==="svg")return lt({children:[e]});if(e.tagName||e&&e.nodeType===3)return e;if(e&&e.component&&e.component.isClass)return me(e);if(e.isClass)return me({component:e,props:{}});if(e.component&&typeof e.component=="function")return ct(e);if(Array.isArray(e))return e.map(t=>k(t)).flat();if(typeof e=="function"&&!e.isClass)return k(e());if(e.component&&e.component.tagName&&typeof e.component.tagName=="string"||Array.isArray(e.component)||e.component)return k(e.component);if(typeof e=="object")return[];console.warn("Something unexpected happened with:",e)},ct=e=>{const{component:t,props:i}=e;return k(t(i))},me=e=>{const{component:t,props:i}=e,s=at(t.toString());t.prototype._getHash=()=>s;const a=new t(i);q()||a.willMount();let r=a.render();return r=k(r),a.elements=r,i&&i.ref&&i.ref(a),q()||ot(()=>{a._didMount()}),r},_e=e=>document.createElementNS("http://www.w3.org/2000/svg",e),ut=(e,t={},...i)=>{if(t&&t.children&&(Array.isArray(i)?Array.isArray(t.children)?i=[...t.children,...i]:i.push(t.children):Array.isArray(t.children)?i=t.children:i=[t.children]),q()&&_nano.ssrTricks.isWebComponent(e)){const n=_nano.ssrTricks.renderWebComponent(e,t,i,k);return n===null?`ERROR: "<${e} />"`:n}if(typeof e!="string")return{component:e,props:Object.assign(Object.assign({},t),{children:i})};try{if(q()&&typeof e=="string"&&!document)throw new Error("document is not defined")}catch(n){console.log("ERROR:",n.message,`
 > Please read: https://github.com/nanojsx/nano/issues/106`)}let s;const a=e==="svg"?_e("svg"):document.createElement(e),r=(n,u)=>u.indexOf("on")!==0?!1:n._ssr?!0:typeof n[u]=="object"||typeof n[u]=="function";for(const n in t){if(n==="style"&&typeof t[n]=="object"){const u=Object.keys(t[n]).map(o=>`${o}:${t[n][o]}`).join(";").replace(/[A-Z]/g,o=>`-${o.toLowerCase()}`);t[n]=`${u};`}if(n==="ref")s=t[n];else if(r(a,n.toLowerCase()))a.addEventListener(n.toLowerCase().substring(2),u=>t[n](u));else if(n==="dangerouslySetInnerHTML"&&t[n].__html)if(q())a.innerHTML=t[n].__html;else{const u=document.createElement("fragment");u.innerHTML=t[n].__html,a.appendChild(u)}else if(n==="innerHTML"&&t[n].__dangerousHtml)if(q())a.innerHTML=t[n].__dangerousHtml;else{const u=document.createElement("fragment");u.innerHTML=t[n].__dangerousHtml,a.appendChild(u)}else/^className$/i.test(n)?a.setAttribute("class",t[n]):typeof t[n]<"u"&&a.setAttribute(n,t[n])}const c=!["noscript","script","style"].includes(e);return se(a,i,c),s&&s(a),a};var dt=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]]);return i};const C=function(e,t){let{children:i=[]}=t,s=dt(t,["children"]);return Array.isArray(i)||(i=[i]),ut(e,s,...i)};function ht(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D={},ae={},ye;function A(){return ye||(ye=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.h=e._render=e.hydrate=e.render=e.appendChildren=e.strToHash=e.removeAllChildNodes=e.tick=e.isSSR=void 0;const t=()=>typeof _nano<"u"&&_nano.isSSR===!0;e.isSSR=t,e.tick=Promise.prototype.then.bind(Promise.resolve());const i=l=>{for(;l.firstChild;)l.removeChild(l.firstChild)};e.removeAllChildNodes=i;const s=l=>{let d=0;for(let _=0;_<l.length;_++){const g=l.charCodeAt(_);d=(d<<5)-d+g,d|=0}return Math.abs(d).toString(32)};e.strToHash=s;const a=(l,d,_=!0)=>{if(!Array.isArray(d)){(0,e.appendChildren)(l,[d],_);return}typeof d=="object"&&(d=Array.prototype.slice.call(d)),d.forEach(g=>{if(Array.isArray(g))(0,e.appendChildren)(l,g,_);else{const b=(0,e._render)(g);typeof b<"u"&&(Array.isArray(b)?(0,e.appendChildren)(l,b,_):(0,e.isSSR)()&&!_?l.appendChild(b.nodeType==null?b.toString():b):l.appendChild(b.nodeType==null?document.createTextNode(b.toString()):b))}})};e.appendChildren=a;const r=l=>{const d=l.children[0],_=d.attributes;if((0,e.isSSR)())return d;const g=f("svg");for(let b=_.length-1;b>=0;b--)g.setAttribute(_[b].name,_[b].value);return g.innerHTML=d.innerHTML,g},c=(l,d=null,_=!0)=>{let g=(0,e._render)(l);return Array.isArray(g)&&(g=g.map(b=>(0,e._render)(b)),g.length===1&&(g=g[0])),d?(_&&(0,e.removeAllChildNodes)(d),g&&d.id&&d.id===g.id&&d.parentElement?d.parentElement.replaceChild(g,d):Array.isArray(g)?g.forEach(b=>{(0,e.appendChildren)(d,(0,e._render)(b))}):(0,e.appendChildren)(d,(0,e._render)(g)),d):(0,e.isSSR)()&&!Array.isArray(g)?[g]:g};e.render=c,e.hydrate=e.render;const n=l=>{if(l===null||l===!1||typeof l>"u")return[];if(typeof l=="string"||typeof l=="number")return l.toString();if(l.tagName&&l.tagName.toLowerCase()==="svg")return r({children:[l]});if(l.tagName||l&&l.nodeType===3)return l;if(l&&l.component&&l.component.isClass)return o(l);if(l.isClass)return o({component:l,props:{}});if(l.component&&typeof l.component=="function")return u(l);if(Array.isArray(l))return l.map(d=>(0,e._render)(d)).flat();if(typeof l=="function"&&!l.isClass)return(0,e._render)(l());if(l.component&&l.component.tagName&&typeof l.component.tagName=="string"||Array.isArray(l.component)||l.component)return(0,e._render)(l.component);if(typeof l=="object")return[];console.warn("Something unexpected happened with:",l)};e._render=n;const u=l=>{const{component:d,props:_}=l;return(0,e._render)(d(_))},o=l=>{const{component:d,props:_}=l,g=(0,e.strToHash)(d.toString());d.prototype._getHash=()=>g;const b=new d(_);(0,e.isSSR)()||b.willMount();let E=b.render();return E=(0,e._render)(E),b.elements=E,_&&_.ref&&_.ref(b),(0,e.isSSR)()||(0,e.tick)(()=>{b._didMount()}),E},f=l=>document.createElementNS("http://www.w3.org/2000/svg",l),y=(l,d={},..._)=>{if(d&&d.children&&(Array.isArray(_)?Array.isArray(d.children)?_=[...d.children,..._]:_.push(d.children):Array.isArray(d.children)?_=d.children:_=[d.children]),(0,e.isSSR)()&&_nano.ssrTricks.isWebComponent(l)){const h=_nano.ssrTricks.renderWebComponent(l,d,_,e._render);return h===null?`ERROR: "<${l} />"`:h}if(typeof l!="string")return{component:l,props:Object.assign(Object.assign({},d),{children:_})};try{if((0,e.isSSR)()&&typeof l=="string"&&!document)throw new Error("document is not defined")}catch(h){console.log("ERROR:",h.message,`
 > Please read: https://github.com/nanojsx/nano/issues/106`)}let g;const b=l==="svg"?f("svg"):document.createElement(l),E=(h,p)=>p.indexOf("on")!==0?!1:h._ssr?!0:typeof h[p]=="object"||typeof h[p]=="function";for(const h in d){if(h==="style"&&typeof d[h]=="object"){const p=Object.keys(d[h]).map(S=>`${S}:${d[h][S]}`).join(";").replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`);d[h]=`${p};`}if(h==="ref")g=d[h];else if(E(b,h.toLowerCase()))b.addEventListener(h.toLowerCase().substring(2),p=>d[h](p));else if(h==="dangerouslySetInnerHTML"&&d[h].__html)if((0,e.isSSR)())b.innerHTML=d[h].__html;else{const p=document.createElement("fragment");p.innerHTML=d[h].__html,b.appendChild(p)}else if(h==="innerHTML"&&d[h].__dangerousHtml)if((0,e.isSSR)())b.innerHTML=d[h].__dangerousHtml;else{const p=document.createElement("fragment");p.innerHTML=d[h].__dangerousHtml,b.appendChild(p)}else/^className$/i.test(h)?b.setAttribute("class",d[h]):typeof d[h]<"u"&&b.setAttribute(h,d[h])}const P=!["noscript","script","style"].includes(l);return(0,e.appendChildren)(b,_,P),g&&g(b),b};e.h=y})(ae)),ae}var W={},T={},J={},be;function ve(){return be||(be=1,Object.defineProperty(J,"__esModule",{value:!0}),J.VERSION=void 0,J.VERSION="0.1.0"),J}var Se;function Z(){if(Se)return T;Se=1,Object.defineProperty(T,"__esModule",{value:!0}),T.printVersion=T.escapeHtml=T.onNodeRemove=T.detectSSR=T.nodeToString=T.task=void 0;const e=ve(),t=u=>setTimeout(u,0);T.task=t;const i=u=>{const o=document.createElement("div");return o.appendChild(u.cloneNode(!0)),o.innerHTML};T.nodeToString=i;const s=()=>{const u=typeof Deno<"u",o=typeof window<"u";return typeof _nano<"u"&&_nano.isSSR||u||!o};T.detectSSR=s;function a(u,o){return!!u&&(u===o||a(u.parentNode,o))}const r=(u,o)=>{let f=new MutationObserver(y=>{y.forEach(l=>{l.removedNodes.forEach(d=>{a(u,d)&&(o(),f&&(f.disconnect(),f=void 0))})})});return f.observe(document,{childList:!0,subtree:!0}),f};T.onNodeRemove=r;const c=u=>u&&typeof u=="string"?u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):u;T.escapeHtml=c;const n=()=>{const u=`Powered by nano JSX v${e.VERSION}`;console.log(`%c %c %c %c %c ${u} %c http://nanojsx.io`,"background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")};return T.printVersion=n,T}var le={},je;function we(){return je||(je=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._clearState=e._state=void 0,e._state=new Map;const t=()=>{e._state.clear()};e._clearState=t})(le)),le}var Oe;function N(){if(Oe)return W;Oe=1,Object.defineProperty(W,"__esModule",{value:!0}),W.Component=void 0;const e=Z(),t=A(),i=we();class s{constructor(r){this._elements=[],this._skipUnmount=!1,this._hasUnmounted=!1,this.props=r||{},this.id=this._getHash()}static get isClass(){return!0}get isClass(){return!0}setState(r,c=!1){typeof r=="object"&&r!==null&&this.state!==void 0?this.state=Object.assign(Object.assign({},this.state),r):this.state=r,c&&this.update()}set state(r){i._state.set(this.id,r)}get state(){return i._state.get(this.id)}set initState(r){this.state===void 0&&(this.state=r)}get elements(){return this._elements||[]}set elements(r){Array.isArray(r)||(r=[r]),r.forEach(c=>{this._elements.push(c)})}_addNodeRemoveListener(){/^[^{]+{\s+}$/gm.test(this.didUnmount.toString())||(0,e.onNodeRemove)(this.elements[0],()=>{this._skipUnmount||this._didUnmount()})}_didMount(){this._addNodeRemoveListener(),this.didMount()}_willUpdate(){this.willUpdate()}_didUpdate(){this.didUpdate()}_didUnmount(){this._hasUnmounted||(this.didUnmount(),this._hasUnmounted=!0)}willMount(){}didMount(){}willUpdate(){}didUpdate(){}didUnmount(){}render(r){}update(r){this._skipUnmount=!0,this._willUpdate();const c=[...this.elements];this._elements=[];let n=this.render(r);n=(0,t._render)(n),this.elements=n;const u=c[0].parentElement;u||console.warn("Component needs a parent element to get updated!"),this.elements.forEach(o=>{u&&u.insertBefore(o,c[0])}),c.forEach(o=>{this.elements.includes(o)||(o.remove(),o=null)}),this._addNodeRemoveListener(),(0,t.tick)(()=>{this._skipUnmount=!1,this.elements[0].isConnected?this._didUpdate():this._didUnmount()})}_getHash(){}}return W.Component=s,W}var I={},X={},Pe;function ce(){if(Pe)return X;Pe=1,Object.defineProperty(X,"__esModule",{value:!0}),X.Helmet=void 0;const e=N(),t=A();class i extends Map{toString(){let r="";for(const[c,n]of this)r+=` ${c}="${n}"`;return r.trim()}}class s extends e.Component{static SSR(r){var c,n;const u=/(<helmet\b[^>]*>)((.|\r|\n)*?)(<\/helmet>)/gm,o=[],f=[],y={html:new i,body:new i};if(typeof document<"u"&&document.head){let _=[];_=[].slice.call(document.head.children);for(let g=0;g<_.length;g++)o.indexOf(_[g])===-1&&o.push(_[g])}let l;for(;(l=u.exec(r))!==null;){const _=l[1];let g=l[2];const b=/<html\s([^>]+)><\/html>/gm,E=/<body\s([^>]+)><\/body>/gm,P=/(\w+)="([^"]+)"/gm;let h=null;(c=r.match(b))===null||c===void 0||c.forEach(S=>{for(g=g.replace(S,"");(h=P.exec(S))!==null;)y.html.set(h[1],h[2])}),(n=r.match(E))===null||n===void 0||n.forEach(S=>{for(g=g.replace(S,"");(h=P.exec(S))!==null;)y.body.set(h[1],h[2])});const p=_.includes('data-placement="head"');p&&!o.includes(g)?o.push(g):!p&&!f.includes(g)&&f.push(g)}return{body:r.replace(u,""),head:o,footer:f,attributes:y}}didMount(){this.props.children.forEach(r=>{var c,n,u,o;if(!(r instanceof HTMLElement))return;const f=this.props.footer?document.body:document.head,y=r.tagName;let l=[];l.push(r.innerText);for(let g=0;g<r.attributes.length;g++)l.push((c=r.attributes.item(g))===null||c===void 0?void 0:c.name.toLowerCase()),l.push((n=r.attributes.item(g))===null||n===void 0?void 0:n.value.toLowerCase());if(y==="HTML"||y==="BODY"){const g=document.getElementsByTagName(y)[0];for(let b=1;b<l.length;b+=2)g.setAttribute(l[b],l[b+1]);return}else if(y==="TITLE"){const g=document.getElementsByTagName("TITLE");if(g.length>0){const b=r;g[0].text=b.text}else{const b=(0,t.h)("title",null,r.innerHTML);(0,t.appendChildren)(f,[b],!1)}return}let d=!1;l=l.sort();const _=document.getElementsByTagName(y);for(let g=0;g<_.length;g++){let b=[];b.push(_[g].innerText);for(let E=0;E<_[g].attributes.length;E++)b.push((u=_[g].attributes.item(E))===null||u===void 0?void 0:u.name.toLowerCase()),b.push((o=_[g].attributes.item(E))===null||o===void 0?void 0:o.value.toLowerCase());b=b.sort(),l.length>0&&b.length>0&&JSON.stringify(l)===JSON.stringify(b)&&(d=!0)}d||(0,t.appendChildren)(f,[r],!1)})}render(){const r=this.props.footer?"footer":"head";return(0,t.isSSR)()?(0,t.h)("helmet",{"data-ssr":!0,"data-placement":r},this.props.children):[]}}return X.Helmet=s,X}var B={},Ce;function ft(){if(Ce)return B;Ce=1;var e=B&&B.__rest||function(a,r){var c={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&r.indexOf(n)<0&&(c[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,n=Object.getOwnPropertySymbols(a);u<n.length;u++)r.indexOf(n[u])<0&&Object.prototype.propertyIsEnumerable.call(a,n[u])&&(c[n[u]]=a[n[u]]);return c};Object.defineProperty(B,"__esModule",{value:!0}),B.Img=void 0;const t=N(),i=A();class s extends t.Component{constructor(r){super(r);const{src:c,key:n}=r;this.id=`${(0,i.strToHash)(c)}-${(0,i.strToHash)(JSON.stringify(r))}`,n&&(this.id+=`key-${n}`),this.state||this.setState({isLoaded:!1,image:void 0})}didMount(){const r=this.props,{lazy:c=!0,placeholder:n,children:u,key:o,ref:f}=r,y=e(r,["lazy","placeholder","children","key","ref"]);if(typeof c=="boolean"&&c===!1)return;new IntersectionObserver((d,_)=>{d.forEach(g=>{g.isIntersecting&&(_.disconnect(),this.state.image=(0,i.h)("img",Object.assign({},y)),this.state.image.complete?(this.state.isLoaded=!0,this.update()):this.state.image.onload=()=>{this.state.isLoaded=!0,this.update()})})},{threshold:[0,1]}).observe(this.elements[0])}render(){const r=this.props,{src:c,placeholder:n,children:u,lazy:o=!0,key:f,ref:y}=r,l=e(r,["src","placeholder","children","lazy","key","ref"]);if(typeof o=="boolean"&&o===!1)return this.state.image=(0,i.h)("img",Object.assign({src:c},l)),this.state.image;if(this.state.isLoaded)return this.state.image;if(n&&typeof n=="string")return(0,i.h)("img",Object.assign({src:n},l));if(n&&typeof n=="function")return n();{const d={};l.width&&(d.width=`${l.width}px`),l.height&&(d.height=`${l.height}px`);const{width:_,height:g}=l,b=e(l,["width","height"]);return(0,i.h)("div",Object.assign({style:d},b))}}}return B.Img=s,B}var V={},Y={},Re;function ue(){if(Re)return Y;Re=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.Fragment=void 0;const e=t=>t.children;return Y.Fragment=e,Y}var Ee;function gt(){if(Ee)return V;Ee=1;var e=V&&V.__rest||function(c,n){var u={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&n.indexOf(o)<0&&(u[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,o=Object.getOwnPropertySymbols(c);f<o.length;f++)n.indexOf(o[f])<0&&Object.prototype.propertyIsEnumerable.call(c,o[f])&&(u[o[f]]=c[o[f]]);return u};Object.defineProperty(V,"__esModule",{value:!0}),V.Link=void 0;const t=N(),i=ce(),s=A(),a=ue();class r extends t.Component{prefetchOnHover(){this.elements[0].addEventListener("mouseover",()=>this.addPrefetch(),{once:!0})}prefetchOnVisible(){new IntersectionObserver((u,o)=>{u.forEach(f=>{f.isIntersecting&&(o.disconnect(),this.addPrefetch())})},{threshold:[0,1]}).observe(this.elements[0])}addPrefetch(){let n=!1;const u=document.getElementsByTagName("link");for(let o=0;o<u.length;o++)u[o].getAttribute("rel")==="prefetch"&&u[o].getAttribute("href")===this.props.href&&(n=!0);if(!n){const o=(0,s.h)("link",{rel:"prefetch",href:this.props.href,as:"document"});document.head.appendChild(o)}}didMount(){const{href:n,prefetch:u,delay:o=0,back:f=!1}=this.props;f&&this.elements[0].addEventListener("click",y=>{y.preventDefault();const l=y.target;l.href===document.referrer?window.history.back():window.location.href=l.href}),o>0&&this.elements[0].addEventListener("click",y=>{y.preventDefault(),setTimeout(()=>window.location.href=n,o)}),u&&(u==="hover"?this.prefetchOnHover():u==="visible"?this.prefetchOnVisible():this.addPrefetch())}render(){const n=this.props,{children:u,prefetch:o,back:f,ref:y}=n,l=e(n,["children","prefetch","back","ref"]);this.props.href||console.warn('Please add "href" to <Link>'),u.length!==1&&console.warn("Please add ONE child to <Link> (<Link>child</Link>)");const d=(0,s.h)("a",Object.assign({},l),...u);if(o===!0&&!(typeof window<"u"&&window.document)){const _=(0,s.h)("link",{rel:"prefetch",href:this.props.href,as:"document"}),g=(0,s.h)(i.Helmet,null,_);return(0,s.h)(a.Fragment,null,[g,d])}else return d}}return V.Link=r,V}var K={},Me;function pt(){return Me||(Me=1,(function(e){var t=K&&K.__rest||function(h,p){var S={};for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&p.indexOf(m)<0&&(S[m]=h[m]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(h);v<m.length;v++)p.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(h,m[v])&&(S[m[v]]=h[m[v]]);return S};Object.defineProperty(e,"__esModule",{value:!0}),e.parseParamsFromPath=e.Listener=e.Link=e.to=e.Route=e.Routes=e.Switch=e.matchPath=void 0;const i=N(),s=A(),a=[],r=h=>a.push(h),c=h=>a.splice(a.indexOf(h),1),n=h=>{window.history.pushState({},"",h),a.forEach(p=>p.handleChanges()),window.dispatchEvent(new Event("pushstate"))},u=h=>{window.history.replaceState({},"",h),a.forEach(p=>p.handleChanges()),window.dispatchEvent(new Event("replacestate"))},o=(h,p)=>{const{exact:S=!1,regex:m}=p;let{path:v}=p;if(!v)return{path:null,url:h,isExact:!0,params:{}};let O,j={};if(v.includes("/:")){const M=v.split("/"),w=h.split("/");M.forEach((F,fe)=>{if(/^:/.test(F)){const ge=F.slice(1),Xe=w[fe];if(m&&m[ge]&&!m[ge].test(Xe))return null;j=Object.assign(Object.assign({},j),{[ge]:Xe}),M[fe]=w[fe]}}),v=M.join("/")}if(v==="*"&&(O=[h]),O||(O=new RegExp(`^${v}`).exec(h)),!O)return null;const R=O[0],L=h===R;return S&&!L?null:{path:v,url:R,isExact:L,params:j}};e.matchPath=o;class f extends i.Component{constructor(){super(...arguments),this.index=0,this.path="",this.match={index:-1,path:""}}didMount(){window.addEventListener("popstate",this.handleChanges.bind(this)),r(this)}didUnmount(){window.removeEventListener("popstate",this.handleChanges.bind(this)),c(this)}handleChanges(){this.findChild(),this.shouldUpdate()&&this.update()}findChild(){this.match={index:-1,path:""},this.props.children=this.props.children.flat();for(let p=0;p<this.props.children.length;p++){const S=this.props.children[p],{path:m,exact:v,regex:O}=S.props;if((0,e.matchPath)((0,s.isSSR)()?_nano.location.pathname:window.location.pathname,{path:m,exact:v,regex:O})){this.match.index=p,this.match.path=m;return}}}shouldUpdate(){return this.path!==this.match.path||this.index!==this.match.index}render(){this.findChild();const p=this.props.children[this.match.index];if(this.match.index===-1&&(this.path="",this.index=0),p){const{path:S}=p.props;this.path=S,this.index=this.match.index;const m=(0,s._render)(p);return(0,s.h)("div",{},(0,s._render)(m))}else return this.props.fallback?(0,s.h)("div",{},(0,s._render)(this.props.fallback)):(0,s.h)("div",{},"not found")}}e.Switch=f;class y extends f{}e.Routes=y;const l=({path:h,regex:p,children:S})=>{const m=(0,s.isSSR)()?_nano.location.pathname:window.location.pathname,v=(0,e.parseParamsFromPath)(h);return S.forEach(O=>{O.props&&(O.props=Object.assign(Object.assign({},O.props),{route:{path:h,regex:p,pathname:m,params:v}}))}),S};e.Route=l;const d=(h,p=!1)=>{p?u(h):n(h)};e.to=d;const _=h=>{var{to:p,replace:S,children:m}=h,v=t(h,["to","replace","children"]);const O=j=>{j.preventDefault(),S?u(p):n(p)};return(0,s.h)("a",Object.assign({href:p,onClick:j=>O(j)},v),m)};e.Link=_;class g{constructor(){if(this._listeners=new Map,(0,s.isSSR)())return;this._route=window.location.pathname;const p=()=>{const S=window.location.pathname;this._listeners.forEach(m=>{m(S,this._route)}),this._route=S};window.addEventListener("pushstate",p),window.addEventListener("replacestate",p)}use(){const p=Math.random().toString(36).substring(2);return{subscribe:S=>{this._listeners.set(p,S)},cancel:()=>{this._listeners.has(p)&&this._listeners.delete(p)}}}}let b;const E=()=>(b||(b=new g),b);e.Listener=E;const P=h=>{let p={};const S=(0,s.isSSR)()?_nano.location.pathname.split("/"):window.location.pathname.split("/");return h.split("/").forEach((m,v)=>{m.startsWith(":")&&(p=Object.assign(Object.assign({},p),{[m.slice(1)]:S[v]}))}),p};e.parseParamsFromPath=P})(K)),K}var H={},Le;function mt(){if(Le)return H;Le=1;var e=H&&H.__awaiter||function(r,c,n,u){function o(f){return f instanceof n?f:new n(function(y){y(f)})}return new(n||(n=Promise))(function(f,y){function l(g){try{_(u.next(g))}catch(b){y(b)}}function d(g){try{_(u.throw(g))}catch(b){y(b)}}function _(g){g.done?f(g.value):o(g.value).then(l,d)}_((u=u.apply(r,c||[])).next())})},t=H&&H.__rest||function(r,c){var n={};for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&c.indexOf(u)<0&&(n[u]=r[u]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,u=Object.getOwnPropertySymbols(r);o<u.length;o++)c.indexOf(u[o])<0&&Object.prototype.propertyIsEnumerable.call(r,u[o])&&(n[u[o]]=r[u[o]]);return n};Object.defineProperty(H,"__esModule",{value:!0}),H.Suspense=void 0;const i=N(),s=A();class a extends i.Component{constructor(c){super(c),this.ready=!1;const n=this.props,{children:u,fallback:o,cache:f=!1}=n,y=t(n,["children","fallback","cache"]),l=JSON.stringify(y,function(d,_){return typeof _=="function"?`${_}`:_});this.id=(0,s.strToHash)(JSON.stringify(l))}didMount(){return e(this,void 0,void 0,function*(){const c=this.props,{children:n,fallback:u,cache:o=!1}=c,f=t(c,["children","fallback","cache"]);if(o&&(this.initState={}),this.loadFromCache(o))return;const y=Object.values(f).map(_=>_()),l=yield Promise.all(y),d=this.prepareData(f,l,o);this.addDataToChildren(d),this.ready=!0,this.update()})}ssr(){const c=this.props,{children:n,fallback:u,cache:o=!1}=c,f=t(c,["children","fallback","cache"]),y=Object.values(f).map(d=>d()),l=this.prepareData(f,y,!1);this.addDataToChildren(l)}loadFromCache(c){const n=this.state&&c&&Object.keys(this.state).length>0;return n&&(this.addDataToChildren(this.state),this.ready=!0),n}prepareData(c,n,u){return Object.keys(c).reduce((f,y,l)=>(u&&(this.state=Object.assign(Object.assign({},this.state),{[y]:n[l]})),Object.assign(Object.assign({},f),{[y]:n[l]})),{})}addDataToChildren(c){this.props.children.forEach(n=>{n.props&&(n.props=Object.assign(Object.assign({},n.props),c))})}render(){if((0,s.isSSR)())return this.ssr(),this.props.children;{const{cache:c=!1}=this.props;return this.loadFromCache(c),this.ready?this.props.children:this.props.fallback}}}return H.Suspense=a,H}var Q={},Ae;function Te(){if(Ae)return Q;Ae=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.Visible=void 0;const e=A(),t=N();class i extends t.Component{constructor(){super(...arguments),this.isVisible=!1}didMount(){new IntersectionObserver((r,c)=>{r.forEach(n=>{n.isIntersecting&&(c.disconnect(),this.isVisible=!0,this.update())})},{threshold:[0,1]}).observe(this.elements[0])}render(){return this.isVisible?(this.props.onVisible&&this.props.onVisible(),(0,e.render)(this.props.component||this.props.children[0])):(0,e.h)("div",{"data-visible":!1,visibility:"hidden"})}}return Q.Visible=i,Q}var ke;function _t(){return ke||(ke=1,(function(e){var t=I&&I.__createBinding||(Object.create?(function(o,f,y,l){l===void 0&&(l=y);var d=Object.getOwnPropertyDescriptor(f,y);(!d||("get"in d?!f.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return f[y]}}),Object.defineProperty(o,l,d)}):(function(o,f,y,l){l===void 0&&(l=y),o[l]=f[y]})),i=I&&I.__setModuleDefault||(Object.create?(function(o,f){Object.defineProperty(o,"default",{enumerable:!0,value:f})}):function(o,f){o.default=f}),s=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var f={};if(o!=null)for(var y in o)y!=="default"&&Object.prototype.hasOwnProperty.call(o,y)&&t(f,o,y);return i(f,o),f};Object.defineProperty(e,"__esModule",{value:!0}),e.Visible=e.Suspense=e.Router=e.Link=e.Img=e.Helmet=void 0;var a=ce();Object.defineProperty(e,"Helmet",{enumerable:!0,get:function(){return a.Helmet}});var r=ft();Object.defineProperty(e,"Img",{enumerable:!0,get:function(){return r.Img}});var c=gt();Object.defineProperty(e,"Link",{enumerable:!0,get:function(){return c.Link}}),e.Router=s(pt());var n=mt();Object.defineProperty(e,"Suspense",{enumerable:!0,get:function(){return n.Suspense}});var u=Te();Object.defineProperty(e,"Visible",{enumerable:!0,get:function(){return u.Visible}})})(I)),I}var de={},$={},Ie;function yt(){if(Ie)return $;Ie=1,Object.defineProperty($,"__esModule",{value:!0}),$.documentSSR=$.DocumentSSR=$.HTMLElementSSR=void 0;const e=Z();class t{constructor(r){this.isSelfClosing=!1,this.nodeType=null,this.tagName=r;const c=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];this.nodeType=1,c.indexOf(r)>=0?(this._ssr=`<${r} />`,this.isSelfClosing=!0):this._ssr=`<${r}></${r}>`}get outerHTML(){return this.toString()}get innerHTML(){return this.innerText}set innerHTML(r){this.innerText=r}get innerText(){var r;return((r=/(^<[^>]+>)(.+)?(<\/[a-z0-9]+>$|\/>$)/gm.exec(this._ssr))===null||r===void 0?void 0:r[2])||""}set innerText(r){const c=/(^<[^>]+>)(.+)?(<\/[a-z0-9]+>$|\/>$)/gm,n=(u,o,f,y)=>[o,r,y].join("");this._ssr=this._ssr.replace(c,n)}getAttribute(r){return null}get classList(){const r=this._ssr,c=/^<\w+.+(\sclass=")([^"]+)"/gm;return{add:n=>{this.setAttribute("class",n)},entries:{get length(){const n=c.exec(r);return n&&n[2]?n[2].split(" ").length:0}}}}toString(){return this._ssr}setAttributeNS(r,c,n){this.setAttribute(c,n)}setAttribute(r,c){const n=(o,f,y)=>`${f}${(0,e.escapeHtml)(r)}="${(0,e.escapeHtml)(c)}" ${y}`,u=(o,f,y)=>`${f} ${(0,e.escapeHtml)(r)}="${(0,e.escapeHtml)(c)}"${y}`;this.isSelfClosing?this._ssr=this._ssr.replace(/(^<[a-z0-9]+ )(.+)/gm,n):this._ssr=this._ssr.replace(/(^<[^>]+)(.+)/gm,u)}append(r){this.appendChild(r)}appendChild(r){const c=this._ssr.lastIndexOf("</");this._ssr=this._ssr.substring(0,c)+r+this._ssr.substring(c)}get children(){const r=/<([a-z0-9]+)((?!<\/\1).)*<\/\1>/gms,c=[];let n;for(;(n=r.exec(this.innerHTML))!==null;)c.push(n[0].replace(/[\s]+/gm," "));return c}addEventListener(r,c,n){}}$.HTMLElementSSR=t;class i{constructor(){this.body=this.createElement("body"),this.head=this.createElement("head")}createElement(r){return new t(r)}createElementNS(r,c){return this.createElement(c)}createTextNode(r){return(0,e.escapeHtml)(r)}querySelector(r){}}$.DocumentSSR=i;const s=()=>new i;return $.documentSSR=s,$}var He;function $e(){return He||(He=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.clearState=e.renderSSR=e.initSSR=void 0;const t=A(),i=yt(),s=we(),a=Z(),r={isWebComponent:f=>typeof f=="string"&&f.includes("-")&&_nano.customElements.has(f),renderWebComponent:(f,y,l,d)=>{const _=_nano.customElements.get(f),b=d({component:_,props:Object.assign(Object.assign({},y),{children:l})}).toString().match(/^<(?<tag>[a-z]+)>(.*)<\/\k<tag>>$/);if(b){let P=function(h,p,S,m){return h.replace(p,"")};const E=document.createElement(b[1]);return E.innerText=b[2],E.innerText=E.innerText.replace(/<\w+[^>]*(\s(on\w*)="[^"]*")/gm,P),E}else return null}};(()=>{const f=(0,a.detectSSR)()===!0?!0:void 0,y={pathname:"/"},l=f?(0,i.documentSSR)():window.document;globalThis._nano={isSSR:f,location:y,document:l,customElements:new Map,ssrTricks:r}})();const n=(f="/")=>{_nano.location={pathname:f},globalThis.document=_nano.document=(0,t.isSSR)()?(0,i.documentSSR)():window.document};e.initSSR=n;const u=(f,y={})=>{const{pathname:l,clearState:d=!0}=y;(0,e.initSSR)(l),d&&s._state.clear();const _=(0,t.render)(f,null,!0);return Array.isArray(_)?_.join(""):Array.from(_).join("")};e.renderSSR=u;const o=()=>{s._state.clear()};e.clearState=o})(de)),de}var U={},G={},ie={},ee={},qe;function Ne(){return qe||(qe=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.MINI=void 0,ee.MINI=!1),ee}var he={},De;function bt(){return De||(De=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.build=e.evaluate=e.treeify=void 0;const t=Ne(),i=0,s=1,a=2,r=3,c=4,n=5,u=6,o=0,f=2,y=3,l=4,d=n,_=u,g=(P,h)=>{const p=m=>{let v="",O=null;const j=[],R=[];for(let L=1;L<m.length;L++){const M=m[L++],w=m[L]?h[m[L++]-1]:m[++L];M===y?v=w:M===l?(j.push(w),O=null):M===d?(O||(O=Object.create(null),j.push(O)),O[m[++L]]=[w]):M===_?O[m[++L]].push(w):M===f?R.push(p(w)):M===o&&R.push(w)}return{tag:v,props:j,children:R}},{children:S}=p(P);return S.length>1?S:S[0]};e.treeify=g;const b=(P,h,p,S)=>{let m;h[0]=0;for(let v=1;v<h.length;v++){const O=h[v++],j=h[v]?(h[0]|=O?1:2,p[h[v++]]):h[++v];O===y?S[0]=j:O===l?S[1]=Object.assign(S[1]||{},j):O===d?(S[1]=S[1]||{})[h[++v]]=j:O===_?S[1][h[++v]]+=`${j}`:O?(m=P.apply(j,(0,e.evaluate)(P,j,p,["",null])),S.push(m),j[0]?h[0]|=2:(h[v-2]=o,h[v]=m)):S.push(j)}return S};e.evaluate=b;const E=function(P,...h){const p=[P,...h],S=this;let m=s,v="",O="",j=[0],R,L;const M=w=>{m===s&&(w||(v=v.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?t.MINI?j.push(w?p[w]:v):j.push(o,w,v):m===r&&(w||v)?(t.MINI?j[1]=w?p[w]:v:j.push(y,w,v),m=a):m===a&&v==="..."&&w?t.MINI?j[2]=Object.assign(j[2]||{},p[w]):j.push(l,w,0):m===a&&v&&!w?t.MINI?(j[2]=j[2]||{})[v]=!0:j.push(d,0,!0,v):m>=n&&(t.MINI?m===n?((j[2]=j[2]||{})[L]=w?v?v+p[w]:p[w]:v,m=u):(w||v)&&(j[2][L]+=w?v+p[w]:v):((v||!w&&m===n)&&(j.push(m,0,v,L),m=u),w&&(j.push(m,w,0,L),m=u))),v=""};for(let w=0;w<P.length;w++){w&&(m===s&&M(),M(w));for(let F=0;F<P[w].length;F++)R=P[w][F],m===s?R==="<"?(M(),t.MINI?j=[j,"",null]:j=[j],m=r):v+=R:m===c?v==="--"&&R===">"?(m=s,v=""):v=R+v[0]:O?R===O?O="":v+=R:R==='"'||R==="'"?O=R:R===">"?(M(),m=s):m&&(R==="="?(m=n,L=v,v=""):R==="/"&&(m<n||P[w][F+1]===">")?(M(),m===r&&(j=j[0]),m=j,t.MINI?(j=j[0]).push(S(...m.slice(1))):(j=j[0]).push(f,0,m),m=i):R===" "||R==="	"||R===`
`||R==="\r"?(M(),m=a):v+=R),m===r&&v==="!--"&&(m=c,j=j[0])}return M(),t.MINI?j.length>2?j.slice(1):j[1]:j};e.build=E})(he)),he}var Be;function vt(){if(Be)return ie;Be=1,Object.defineProperty(ie,"__esModule",{value:!0});const e=Ne(),t=bt(),i=new Map,s=function(a){let r=i.get(this);return r||(r=new Map,i.set(this,r)),r=(0,t.evaluate)(this,r.get(a)||(r.set(a,r=(0,t.build)(a)),r),arguments,[]),r.length>1?r:r[0]};return ie.default=e.MINI?t.build:s,ie}var Ve;function St(){if(Ve)return G;Ve=1;var e=G&&G.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(G,"__esModule",{value:!0});const t=e(vt());return G.default=t.default,G}var Ue;function jt(){if(Ue)return U;Ue=1;var e=U&&U.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(U,"__esModule",{value:!0}),U.jsx=void 0;const t=A(),s=e(St()).default.bind(t.h);return U.jsx=s,U}var te={},xe;function wt(){if(xe)return te;xe=1,Object.defineProperty(te,"__esModule",{value:!0}),te.hydrateLazy=void 0;const e=A(),t=Te(),i=(s,a=null,r=!0)=>{const c=(0,e.h)(t.Visible,null,s);return(0,e.hydrate)(c,a,r)};return te.hydrateLazy=i,te}var ne={},ze;function Ot(){if(ze)return ne;ze=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Store=void 0;const e=A();class t{constructor(s,a="",r="memory"){if(this._listeners=new Map,(0,e.isSSR)()&&(r="memory"),this._id=a,this._storage=r,this._state=this._prevState=s,r==="memory"||!r)return;const c=r==="local"?localStorage:sessionStorage,n=c.getItem(this._id);n?this._state=this._prevState=JSON.parse(n):c.setItem(this._id,JSON.stringify(s))}persist(s){if(this._storage==="memory")return;(this._storage==="local"?localStorage:sessionStorage).setItem(this._id,JSON.stringify(s))}clear(){this._state=this._prevState=void 0,this._storage==="local"?localStorage.removeItem(this._id):this._storage==="session"&&sessionStorage.removeItem(this._id)}setState(s){this.state=s}set state(s){this._prevState=this._state,this._state=s,this.persist(s),this._listeners.forEach(a=>{a(this._state,this._prevState)})}get state(){return this._state}use(){const s=Math.random().toString(36).substring(2,9),a=this;return{get state(){return a.state},setState:r=>{this.state=r},subscribe:r=>{this._listeners.set(s,r)},cancel:()=>{this._listeners.has(s)&&this._listeners.delete(s)}}}}return ne.Store=t,ne}var x={},Fe;function Pt(){if(Fe)return x;Fe=1,Object.defineProperty(x,"__esModule",{value:!0}),x.useContext=x.createContext=void 0;const e=i=>{let s=i;return{Provider:a=>(a.value&&(s=a.value),a.children),Consumer:a=>({component:a.children[0](s),props:Object.assign(Object.assign({},a),{context:s})}),get:()=>s,set:a=>s=a}};x.createContext=e;const t=i=>{const s=i;if(s&&typeof s.get=="function")return s.get()};return x.useContext=t,x}var z={},Ge;function Ct(){if(Ge)return z;Ge=1;var e=z&&z.__rest||function(c,n){var u={};for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&n.indexOf(o)<0&&(u[o]=c[o]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,o=Object.getOwnPropertySymbols(c);f<o.length;f++)n.indexOf(o[f])<0&&Object.prototype.propertyIsEnumerable.call(c,o[f])&&(u[o[f]]=c[o[f]]);return u};Object.defineProperty(z,"__esModule",{value:!0}),z.withStyles=void 0;const t=A(),i=N(),s=ue(),a=ce(),r=(...c)=>n=>class extends i.Component{render(){const u=this.props,{children:o}=u,f=e(u,["children"]),y=[];c.forEach(d=>{var _;if(typeof d=="string")y.push((0,t.h)(a.Helmet,null,(0,t.h)("style",null,d)));else if(typeof d=="function"){const g=d();typeof g=="string"&&y.push((0,t.h)(a.Helmet,null,(0,t.h)("style",null,g)))}else if(typeof d=="object"){const g=(_=d.toString)===null||_===void 0?void 0:_.call(d);typeof g=="string"&&y.push((0,t.h)(a.Helmet,null,(0,t.h)("style",null,g)))}});const l=o&&o.length>0?(0,t.h)(n,Object.assign({},f),o):(0,t.h)(n,Object.assign({},this.props));return(0,t.h)(s.Fragment,null,...y,l)}};return z.withStyles=r,z}var re={},We;function Rt(){if(We)return re;We=1,Object.defineProperty(re,"__esModule",{value:!0}),re.defineAsCustomElements=void 0;const e=A(),t=(s,a,r=[],c={})=>{/^[a-zA-Z0-9]+-[a-zA-Z0-9]+$/.test(a)?_nano.customElements.set(a,s):console.log(`Error: WebComponent name "${a}" is invalid.`)},i=function(s,a,r,c){if((0,e.isSSR)()){t(s,a,r);return}customElements.define(a,class extends HTMLElement{constructor(){super(),c?(this.attachShadow(c),this.$root=this.shadowRoot):this.$root=this;let n;const u=this.buildEl((0,e._render)({component:s,props:{ref:o=>n=o,children:Array.from(this.children).map(o=>(0,e.render)(o))}}));this.component=n,this.isFunctionalComponent=!s.isClass,this.functionalComponentsProps={},this.appendEl(u),this.isFunctionalComponent||(this.component.updatePropsValue=(o,f)=>{this.component.props||(this.component.props={}),this.component.props[o]=f,this.component[o]=f})}static get observedAttributes(){return r}buildEl(n){return(0,e.h)(this.shadowRoot?"div":"template",null,n)}appendEl(n){this.shadowRoot?this.$root.append(n):this.$root.append(...n.childNodes)}removeChildren(){var n;if(this.$root){const u=Array.from((n=this.$root)===null||n===void 0?void 0:n.children)||[];for(const o of u)o.remove()}}attributeChangedCallback(n,u,o){if(!this.isFunctionalComponent)this.component.updatePropsValue(n,o),this.component.update();else{this.removeChildren(),this.functionalComponentsProps[n]=o;const f=this.buildEl((0,e._render)({component:s,props:Object.assign({children:[],ref:y=>this.component=y},this.functionalComponentsProps)}));this.appendEl(f)}}})};return re.defineAsCustomElements=i,re}var Je;function Et(){return Je||(Je=1,(function(e){var t=D&&D.__createBinding||(Object.create?(function(P,h,p,S){S===void 0&&(S=p);var m=Object.getOwnPropertyDescriptor(h,p);(!m||("get"in m?!h.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return h[p]}}),Object.defineProperty(P,S,m)}):(function(P,h,p,S){S===void 0&&(S=p),P[S]=h[p]})),i=D&&D.__exportStar||function(P,h){for(var p in P)p!=="default"&&!Object.prototype.hasOwnProperty.call(h,p)&&t(h,P,p)};Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION=e.printVersion=e.defineAsCustomElements=e.withStyles=e.useContext=e.createContext=e.Store=e.Fragment=e.renderSSR=e.task=e.nodeToString=e.hydrateLazy=e.jsx=e.isSSR=e.Component=e.tick=e.hydrate=e.render=e.h=void 0;var s=A();Object.defineProperty(e,"h",{enumerable:!0,get:function(){return s.h}}),Object.defineProperty(e,"render",{enumerable:!0,get:function(){return s.render}}),Object.defineProperty(e,"hydrate",{enumerable:!0,get:function(){return s.hydrate}}),Object.defineProperty(e,"tick",{enumerable:!0,get:function(){return s.tick}});var a=N();Object.defineProperty(e,"Component",{enumerable:!0,get:function(){return a.Component}}),i(_t(),e);const r=A();Object.defineProperty(e,"isSSR",{enumerable:!0,get:function(){return r.isSSR}});const c=$e();e.default={h:r.h,render:r.render,hydrate:r.hydrate,renderSSR:c.renderSSR,isSSR:r.isSSR};var n=jt();Object.defineProperty(e,"jsx",{enumerable:!0,get:function(){return n.jsx}});var u=wt();Object.defineProperty(e,"hydrateLazy",{enumerable:!0,get:function(){return u.hydrateLazy}});var o=Z();Object.defineProperty(e,"nodeToString",{enumerable:!0,get:function(){return o.nodeToString}}),Object.defineProperty(e,"task",{enumerable:!0,get:function(){return o.task}});var f=$e();Object.defineProperty(e,"renderSSR",{enumerable:!0,get:function(){return f.renderSSR}});var y=ue();Object.defineProperty(e,"Fragment",{enumerable:!0,get:function(){return y.Fragment}});var l=Ot();Object.defineProperty(e,"Store",{enumerable:!0,get:function(){return l.Store}});var d=Pt();Object.defineProperty(e,"createContext",{enumerable:!0,get:function(){return d.createContext}}),Object.defineProperty(e,"useContext",{enumerable:!0,get:function(){return d.useContext}});var _=Ct();Object.defineProperty(e,"withStyles",{enumerable:!0,get:function(){return _.withStyles}});var g=Rt();Object.defineProperty(e,"defineAsCustomElements",{enumerable:!0,get:function(){return g.defineAsCustomElements}});var b=Z();Object.defineProperty(e,"printVersion",{enumerable:!0,get:function(){return b.printVersion}});var E=ve();Object.defineProperty(e,"VERSION",{enumerable:!0,get:function(){return E.VERSION}})})(D)),D}var oe=Et();const Ze=ht(oe);class Mt extends oe.Component{willMount(){this.initState={isPressed:!1}}render(){const t=this.state.isPressed?"inset 0 1px 3px rgba(0,0,0,0.15)":"0 1px 3px rgba(0,0,0,0.1)",i=this.state.isPressed?"scale(0.98)":"scale(1)";return C("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",marginBottom:"12px",borderRadius:"8px",backgroundColor:"var(--color-neutral-background)",boxShadow:t,cursor:"pointer",transform:i,transition:"box-shadow 0.2s ease, transform 0.1s ease"},onClick:this.props.onClick?this.props.onClick:void 0,onMouseEnter:s=>{s.currentTarget.style.backgroundColor="var(--color-neutral-background-hover)",s.currentTarget.style.boxShadow="0 2px 5px rgba(0,0,0,0.15)"},onMouseLeave:s=>{s.currentTarget.style.backgroundColor="var(--color-neutral-background)",this.state.isPressed||(s.currentTarget.style.boxShadow=t),this.setState({isPressed:!1})},onMouseDown:()=>this.setState({isPressed:!0}),onMouseUp:()=>this.setState({isPressed:!1}),children:C("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[this.props.icon&&C("span",{style:{fontSize:"20px"},children:this.props.icon}),C("div",{children:[C("div",{style:{fontWeight:600,fontSize:"14px",marginBottom:"4px"},children:this.props.title}),C("div",{style:{fontSize:"12px",color:"var(--color-neutral-text)",opacity:.8},children:this.props.description})]})]})})}}class Lt extends oe.Component{render(){const{visible:t,onClose:i,pages:s,items:a,activePage:r,onGoBack:c}=this.props;s.unshift({id:"general",title:"General",items:a||[]});const n=s.find(o=>o.id===r)||s[0],u=n.id==="general";return C("div",{style:{display:t?"flex":"none",position:"fixed",top:0,left:0,width:"100%",height:"100%",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.5)",zIndex:9999},children:C("div",{style:{background:"var(--color-neutral-background)",padding:"20px",borderRadius:"8px",position:"relative",color:"var(--color-neutral-content-strong)",height:"85%",width:"85%"},children:[C("span",{style:{position:"absolute",top:"5px",right:"10px",cursor:"pointer",fontWeight:"bold"},onClick:i,children:"x"}),C("h2",{children:["ReadIt Settings - ",n.title]}),!u&&C("span",{style:{userSelect:"text",cursor:"pointer",color:"#888",display:"inline-block",marginBottom:"10px",transition:"color 0.2s"},onMouseOver:o=>o.currentTarget.style.color="#007bff",onMouseOut:o=>o.currentTarget.style.color="#888",onClick:c,children:"← Go Back"}),C("div",{id:"settings-tile-container",children:n.items.map(o=>C(Mt,{...o}))})]})})}}class At extends oe.Component{render(){const{onClick:t}=this.props;return C("span",{class:"contents",children:C("faceplate-tracker",{class:"nd:visible contents",action:"click",children:C("rpl-tooltip",{style:"--rpl-z-index-tooltip:1001",class:"nd:visible contents",placement:"bottom",appearance:"inverted",trigger:"hover focus-visible",distance:"8",children:[C("a",{rpl:"","aria-label":"ReadIt Settings",class:`no-underline hover:no-underline active:no-underline
                        button-medium px-[var(--rem8)]
                        button-plain icon items-center justify-center
                        button inline-flex`,id:"settings-open",onClick:t,children:[C("span",{class:"flex items-center justify-center",children:C("span",{class:"flex",children:C("svg",{rpl:"",fill:"currentColor",height:"20","icon-name":"settings-outline",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg",children:C("path",{d:"M10 20c-.401 0-.802-.027-1.2-.079a1.145 1.145 0 0 1-.992-1.137v-1.073a.97.97 0 0 0-.627-.878A.98.98 0 0 0 6.1 17l-.755.753a1.149 1.149 0 0 1-1.521.1 10.16 10.16 0 0 1-1.671-1.671 1.149 1.149 0 0 1 .1-1.523L3 13.906a.97.97 0 0 0 .176-1.069.98.98 0 0 0-.887-.649H1.216A1.145 1.145 0 0 1 .079 11.2a9.1 9.1 0 0 1 0-2.393 1.145 1.145 0 0 1 1.137-.992h1.073a.97.97 0 0 0 .878-.627A.979.979 0 0 0 3 6.1l-.754-.754a1.15 1.15 0 0 1-.1-1.522 10.16 10.16 0 0 1 1.673-1.676 1.155 1.155 0 0 1 1.522.1L6.1 3a.966.966 0 0 0 1.068.176.98.98 0 0 0 .649-.887V1.216A1.145 1.145 0 0 1 8.8.079a9.129 9.129 0 0 1 2.393 0 1.144 1.144 0 0 1 .991 1.137v1.073a.972.972 0 0 0 .628.878A.977.977 0 0 0 13.905 3l.754-.754a1.152 1.152 0 0 1 1.522-.1c.62.49 1.18 1.05 1.671 1.671a1.15 1.15 0 0 1-.1 1.522L17 6.1a.967.967 0 0 0-.176 1.068.98.98 0 0 0 .887.649h1.073a1.145 1.145 0 0 1 1.137.991 9.096 9.096 0 0 1 0 2.392 1.145 1.145 0 0 1-1.137.992h-1.073A1.041 1.041 0 0 0 17 13.905l.753.755a1.149 1.149 0 0 1 .1 1.521c-.49.62-1.05 1.18-1.671 1.671a1.149 1.149 0 0 1-1.522-.1L13.906 17a.97.97 0 0 0-1.069-.176.981.981 0 0 0-.65.887v1.073a1.144 1.144 0 0 1-.99 1.137A9.431 9.431 0 0 1 10 20Zm-.938-1.307a7.638 7.638 0 0 0 1.875 0v-.982a2.292 2.292 0 0 1 3.853-1.6l.693.694a8.796 8.796 0 0 0 1.326-1.326l-.694-.694a2.29 2.29 0 0 1 1.6-3.851h.982a7.746 7.746 0 0 0 0-1.876h-.982a2.213 2.213 0 0 1-2.034-1.4 2.223 2.223 0 0 1 .438-2.451l.694-.693a8.76 8.76 0 0 0-1.327-1.326l-.692.694a2.22 2.22 0 0 1-2.434.445 2.221 2.221 0 0 1-1.419-2.041v-.979a7.638 7.638 0 0 0-1.875 0v.982a2.213 2.213 0 0 1-1.4 2.034 2.23 2.23 0 0 1-2.456-.438l-.693-.694a8.757 8.757 0 0 0-1.326 1.327l.694.692a2.216 2.216 0 0 1 .445 2.434 2.22 2.22 0 0 1-2.041 1.418h-.982a7.746 7.746 0 0 0 0 1.876h.982a2.213 2.213 0 0 1 2.034 1.4 2.223 2.223 0 0 1-.438 2.451l-.694.693c.394.488.838.933 1.326 1.326l.694-.694a2.218 2.218 0 0 1 2.433-.445 2.22 2.22 0 0 1 1.418 2.041v.983ZM10 13.229a3.23 3.23 0 1 1 0-6.458 3.23 3.23 0 0 1 0 6.458Zm0-5.208a1.979 1.979 0 1 0 0 3.958 1.979 1.979 0 0 0 0-3.958Z"})})})}),C("faceplate-screen-reader-content",{children:"ReadIt Settings"})]}),C("span",{slot:"content",children:"ReadIt Settings"})]})})})}}class Tt{constructor(t){this.readit=t,this.visible=!1,this.tiles=[],this.pages=[],this.activePage="general",this.isSettingsVisible=()=>document.getElementById("settings-open")!==null,this.open=()=>{this.visible=!0,this.render()},this.close=()=>{this.visible=!1,this.render()},this.toggle=()=>{this.visible=!this.visible,this.render()},this.modalContainer=document.createElement("div"),document.body.appendChild(this.modalContainer),this.injectButton(),this.listenForNavigations(),this.render()}injectButton(){const t=document.querySelector("body > shreddit-app > reddit-header-large > reddit-header-action-items > header > nav > div.ps-lg.gap-xs.flex.items-center.justify-end ");if(!t||this.isSettingsVisible())return;const i=document.createElement("div");t.appendChild(i),Ze.render(C(At,{onClick:this.open}),i)}listenForNavigations(){unsafeWindow.navigation.onnavigatesuccess=()=>{this.isSettingsVisible()||this.injectButton()}}registerSettingsTile(t){this.tiles.push(t),this.render()}registerSettingsPage(t){this.pages.push(t),this.render()}registerNavigationTile(t){this.tiles.push({title:t.title,description:t.description,icon:t.icon,onClick:()=>{this.activePage=t.id,this.render()}}),this.render()}goBack(){this.activePage="general",this.render()}render(){Ze.render(C(Lt,{visible:this.visible,onClose:this.close,items:this.tiles,pages:this.pages,activePage:this.activePage,onGoBack:()=>this.goBack()}),this.modalContainer)}}class kt{constructor(t){this.readit=t,GM.getValue("readit-storage").then(i=>{i||GM.setValue("readit-storage",{})})}async load(){return await GM.getValue("readit-storage")??{}}async save(t){await GM.setValue("readit-storage",t)}async get(t,i,s){const a=await this.load();return a[t]&&i in a[t]?a[t][i]:s}async set(t,i,s){const a=await this.load();a[t]||(a[t]={}),a[t][i]=s,await this.save(a)}async delete(t,i){const s=await this.load();s[t]&&(delete s[t][i],await this.save(s))}async keys(t){const i=await this.load();return i[t]?Object.keys(i[t]):[]}async clear(t){const i=await this.load();i[t]&&(delete i[t],await this.save(i))}}class It{constructor(t){this.readit=t}info(t){console.log("\x1B[33m[READIT Info]\x1B[0m ",t)}warn(t){console.warn("\x1B[93m[READIT Warn]\x1B[0m",t)}error(t){console.error("\x1B[31m[READIT Error]\x1B[0m ",t)}}class Ht{constructor(){this.version=GM_info.script.version,this.logging=new It(this),this.posts=new Ye(this),this.settings=new Tt(this),this.plugins=new it(this),this.storage=new kt(this),this.plugins.loadPlugins(),this.settings.registerSettingsTile({title:"ReadIt Version",description:this.version}),this.settings.registerSettingsPage({id:"plugins",title:"Plugins",items:this.plugins.loadedPluginList.map(t=>({title:t.name,description:t.version?`v${t.version}`:"No version"}))}),this.settings.registerNavigationTile({id:"plugins",title:"Plugins",description:"Manage your installed plugins",icon:"🧩"}),this.plugins.onLoadedPlugins()}}const $t=new Ht;unsafeWindow.readit=$t})();
